SchemaVersion: 2018-07-01
Owner: "@mongodb/product-perf"
Description: >
  This is a simple test that runs a find on MongoDB to measure the latency of command dispatch.

Clients:
  Default:
    QueryOptions:
      maxPoolSize: 500

WorkloadDefaults:
  - &path ../../phases/comparative/Operations.yml
  - &low_rate 200 per 1 second
  - &high_rate 1000 per 1 second
  - &no_rate 100%
  - &low_threads 2
  - &high_threads 16
  - &num_docs 1000
  - &filter {_id: {^RandomInt: {min: 0, max: *num_docs}}}

# Even Phases are Quiesce
# Odd Phases are population (in phase 1) or test.
Actors:
  - LoadConfig:
      Path: *path
      Key: QuiesceActor
  - LoadConfig:
      Path: *path
      Key: PopulateCollectionActor
      Parameters:
        Threads: 1
        DocumentCount: *num_docs
  # Quiesce in phase [2]
  - LoadConfig:
      Path: *path
      Key: UpdateOneActor
      Parameters:
        Name: UpdateOneLowThreadLowRate
        Active: [3]
        Threads: *low_threads
        GlobalRate: *low_rate
        Comment: Update One Low Thread Low Rate
  # Quiesce in phase [4]
  - LoadConfig:
      Path: *path
      Key: UpdateOneActor
      Parameters:
        Name: UpdateOneLowThreadHighRate
        Active: [5]
        Threads: *low_threads
        GlobalRate: *high_rate
        Filter: *filter
        Comment: Update One Low Thread High Rate
  # Quiesce in phase [6]
  - LoadConfig:
      Path: *path
      Key: UpdateOneActor
      Parameters:
        Name: UpdateOneLowThreadNoRate
        Active: [7]
        Threads: *low_threads
        GlobalRate: *no_rate
        Filter: *filter
        Comment: Update One Low Thread No Rate
  # Quiesce in phase [8]
  - LoadConfig:
      Path: *path
      Key: UpdateOneActor
      Parameters:
        Name: UpdateOneHighThreadLowRate
        Active: [9]
        Threads: *high_threads
        GlobalRate: *low_rate
        Filter: *filter
        Comment: Update One High Thread Low Rate
  # Quiesce in phase [10]
  - LoadConfig:
      Path: *path
      Key: UpdateOneActor
      Parameters:
        Name: UpdateOneHighThreadHighRate
        Active: [11]
        Threads: *high_threads
        GlobalRate: *high_rate
        Filter: *filter
        Comment: Update One High Thread High Rate
  # Quiesce in phase [12]
  - LoadConfig:
      Path: *path
      Key: UpdateOneActor
      Parameters:
        Name: UpdateOneHighThreadNoRate
        Active: [13]
        Threads: *high_threads
        GlobalRate: *no_rate
        Filter: *filter
        Comment: Update One High Thread No Rate
  # Quiesce in phase [14]

AutoRun:
- When:
    mongodb_setup:
      $eq:
      - replica
